library(SingleCellExperiment)
library(ggplot2)
library(BayesSpace)

A1_Tissue = Seurat::FindVariableFeatures(A1_Tissue) #Simple Seurat workflow for PCs
A1_Tissue = Seurat::ScaleData(A1_Tissue)
A1_Tissue = Seurat::RunPCA(A1_Tissue)

diet.seurat = Seurat::DietSeurat(A1_Tissue, graphs = "pca") #slim down Seurat obj prior to conversion
sce = as.SingleCellExperiment(diet.seurat) #convert seurat to SCE
colData(sce) = cbind(colData(sce), A1_Tissue@images$A1_Tissue@coordinates) #add spatial info to SCE



A1.markers <- FindAllMarkers(A1_Tissue, only.pos = TRUE, min.pct = 0.25, logfc.threshold = .25)
A1.markers %>%
  group_by(cluster) %>%
  slice_max(n = 2, order_by = avg_log2FC)


A1.markers %>%
  group_by(cluster) %>%
  top_n(n = 10, wt = avg_log2FC) -> top10
HeatMap<- DoHeatmap(A1_Tissue, features = top10$gene)
